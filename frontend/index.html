<!DOCTYPE html>
<html>
  <head>
    <title>#LoveEU</title>
    <!-- fontawesome-->
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/solid.css" integrity="sha384-r/k8YTFqmlOaqRkZuSiE9trsrDXkh07mRaoGBMoDcmA58OHILZPsk29i2BsFng1B" crossorigin="anonymous">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/fontawesome.css" integrity="sha384-4aon80D8rXCGx9ayDt85LbyUHeMWd3UiBaWliBlJ53yzm9hqN21A+o1pqoyK04h+" crossorigin="anonymous">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<link href="https://fonts.googleapis.com/css?family=Permanent+Marker|Roboto:100" rel="stylesheet">
    <meta charset="utf-8">
    <style>
      html, body {
        font-family: 'Roboto', Arial, Sans;
        margin: 0;
        padding: 0;
        padding-top: 20px;
        text-align: center;
      }
      html{
        height: 100%;
        background-position: bottom right;
        background-image: url('heart.png');
        background-repeat: no-repeat;
      } 
      h1, h2 {
        width: 410px;
        margin-left: auto;
        margin-right: auto;
      }
      h1 {
        font-family: 'Permanent Marker', cursive;
        font-size: 80px;
      }
      h2 {
        font-weight: 100;
        color: gray;
        margin-bottom: 40px;
      }
      input {
        font-family: 'Roboto', Arial, Sans;
        font-size: 30px;
        width: 360px;
        height: 40px;
        padding: 5px;
        border-radius: 4px;
        border: 1px solid #f7f7f7;
      }
      a {
        text-decoration: none;
        color: black;
      }
      #result {
        padding-top: 30px;
        font-size: 24px;
      }
      #result i {
        margin-right: 6px;
        color: red;
      }
      #locateMe {
        margin-left: 6px;
        font-size: 30px;
        opacity: 0.6;
      }
      #locateMe:hover {
        opacity: 1;
      }

    </style>
  </head>
  <body>
      <h1>#LoveEU</h1>
      <h2>Download your poster to put in a window and show you love your town, you love the UK, and you love the EU!</h2>
  <input id="userInput" type="text" placeholder="Where are you?" autofocus> <a id="locateMe" href="#"><i class="fas fa-location-arrow"></i></a>
  <div id="result" style="display: none;">
    <a href="#" id="downloadLink"><i class="fas fa-file-pdf"></i> Download Your <span id="townName"></span> Poster Now!</a><br>
  </div>
  <script type="text/javascript">
      // This example requires the Places library. Include the libraries=places
      // parameter when you first load the API. For example:
      // <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places">
      
      var autocomplete;
      
      function initMap() {

        var options = {
          types: ['geocode'],
          componentRestrictions: {country: 'gb'}
        };
        autocomplete = new google.maps.places.Autocomplete(document.getElementById('userInput'), options);
        autocomplete.setFields(['address_components','geometry']);
        autocomplete.addListener('place_changed', function() {
          var place = autocomplete.getPlace();
          console.log(place);
          processPlace(place);
        });
      }

      function processPlace(place){
        var gotPlace = false;
        var inuk = false;
        for (var i = 0; i < place.address_components.length; i++) {
          for (var j = 0; j < place.address_components[i].types.length; j++) {
            if ((place.address_components[i].types[j] == 'country')&&(place.address_components[i].short_name == 'GB')){
              inuk = true;
            }
          }
        }
        if(!inuk){
          alert('Sorry, this only works for people in the UK.');
          return false;
        }
        for (var i = 0; i < place.address_components.length; i++) {
          for (var j = 0; j < place.address_components[i].types.length; j++) {
            if (place.address_components[i].types[j] == 'postal_town'){
              showResult(place.address_components[i].long_name);
              gotPlace = true;
            }
          }
        }
        if (gotPlace == false){
          for (var i = 0; i < place.address_components.length; i++) {
            for (var j = 0; j < place.address_components[i].types.length; j++) {
              if (place.address_components[i].types[j] == 'locality'){
                showResult(place.address_components[i].long_name);
                gotPlace = true;
              }
            }
          }
        }
        if (gotPlace == false){
          for (var i = 0; i < place.address_components.length; i++) {
            for (var j = 0; j < place.address_components[i].types.length; j++) {
              if (place.address_components[i].types[j] == 'administrative_area_level_2'){
                showResult(place.address_components[i].long_name);
                gotPlace = true;
              }
            }
          }
        }
      }
      function showResult(city){
        $('#userInput').val(city);
        $('#townName').html(city);
        $('#downloadLink').attr('href', 'https://brexit-231311.appspot.com/'+encodeURIComponent(city)+'.pdf');
        $('#result').slideDown();
      }
      // Bias the autocomplete object to the user's geographical location,
      // as supplied by the browser's 'navigator.geolocation' object.
      function geolocate() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
            $.get( "https://maps.googleapis.com/maps/api/geocode/json?latlng="+position.coords.latitude+","+position.coords.longitude+"&key=AIzaSyBB3wZ4G6IoT7PM6ze4lXu50QriGJmSqvg&result_type=postal_town", function( data ) {
              console.log(data);
              if((!data.results)||(data.results.length<1)){
                alert("Sorry, we could not locate you.");
              } else {
                var place = data.results[0];
                console.log(place);
                processPlace(place);
              }
              $('#locateMe').html('<i class="fas fa-location-arrow"></i>');
            });
          }, function(){
            alert("Sorry, we could not locate you.");
            $('#locateMe').html('<i class="fas fa-location-arrow"></i>');
          });
        }
      }
      $( document ).ready(function() {
          $('#locateMe').click(function(e){
            e.preventDefault();
            $('#locateMe').html('<i class="fas fa-spinner fa-spin"></i>');
            geolocate();
          });
      });
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBB3wZ4G6IoT7PM6ze4lXu50QriGJmSqvg&libraries=places&callback=initMap"
        async defer></script>
  </body>
</html>